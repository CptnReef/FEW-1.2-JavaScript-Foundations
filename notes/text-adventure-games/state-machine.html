<!-- 

https://www.smashingmagazine.com/2018/01/rise-state-machines/ 

-->




<script>
  const machine = {
    dispatch(actionName, ...payload) {
      const actions = this.transitions[this.state];
      const action = this.transitions[this.state][actionName];

      if (action) {
        action.apply(machine, ...payload);
      }
    },

    changeStateTo(newState) {
      this.state = newState;
    },

    state: 'idle',
    transitions: {

      'idle': {
        click: function() {
          this.changeStateTo('fetching');
          service.getData().then(
            data => {
              try {
                this.dispatch('success', JSON.parse(data));
              } catch (error) {
                this.dispatch('failure', error)
              }
            },
            error => this.dispatch('failure', error)
          );
        }
      },

      'fetching': {
        success: function(data) {
          // render the data
          this.changeStateTo('idle');
        },
        failure: function(error) {
          this.changeStateTo('error');
        }
      },

      'error': {
        retry: function() {
          this.changeStateTo('idle');
          this.dispatch('click');
        }
      }

    }

  }


  machine.dispatch('click');

</script>
